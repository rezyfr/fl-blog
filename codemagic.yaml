workflows:
  default-workflow:
  name: Default Workflow
  environment:
    vars:
    AWS_ACCESS_KEY_ID: Encrypted(XXXXXXXXX)
    AWS_SECRET_ACCESS_KEY: Encrypted(XXXXXXXXX)
    flutter: dev
  triggering:
    events:
      - push
    branch_patterns:
      - pattern: 'master'
        include: true
        source: true
  scripts:
    - flutter packages pub get
    - flutter config --enable-web
    - flutter test
    - |
    # build web
    flutter build web --release
    cd build/web
    7z a -r ../web.zip ./*
    cd $FCI_BUILD_DIR/build/
    sudo pip3 install awscli --upgrade
    aws s3 sync web/ s3://fl-blog/
  artifacts:
    - build/**/outputs/**/mapping.txt
    - build/web.zip
    - flutter_drive.log